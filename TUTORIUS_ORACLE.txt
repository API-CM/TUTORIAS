DROP TABLE USUARIOS CASCADE CONSTRAINTS;
DROP TABLE PROFESORES CASCADE CONSTRAINTS;
DROP TABLE DIAS_HORARIOS CASCADE CONSTRAINTS;
DROP TABLE FRANJAS_HORARIAS CASCADE CONSTRAINTS;
DROP TABLE DEPARTAMENTOS CASCADE CONSTRAINTS;
DROP TABLE ASIG_IMPARTIDAS CASCADE CONSTRAINTS;
DROP TABLE ASIGNATURAS CASCADE CONSTRAINTS;
DROP TABLE RESERVAS CASCADE CONSTRAINTS;

ALTER SESSION SET NLS_DATE_FORMAT='DD/MM/YYYY';
SET SERVEROUTPUT ON;

CREATE TABLE USUARIOS(
UVUS_ALUMNO VARCHAR2(15) PRIMARY KEY,
NOMBRE VARCHAR2(20),
APELLIDO1 VARCHAR2(20),
APELLIDO2 VARCHAR2(20),
PASSWORD VARCHAR2(20),
EMAIL VARCHAR2(50)
);

CREATE TABLE ASIG_FAVORITAS(
UVUS_ALUMNO VARCHAR2(15)
ID_ASIGNATURA NUMBER(5)
PRIMARY KEY (UVUS_ALUMNO,ID_ASIGNATURA)
);


CREATE TABLE FRANJAS_HORARIAS(
ID_FRANJA_HORARIA NUMBER(5),
DIA_SEMANA VARCHAR2(10),
HORA_INICIO VARCHAR2(5),
HORA_FIN VARCHAR2(5)
);


CREATE TABLE DIAS_HORARIOS(
UVUS_PROFESOR VARCHAR2(15),
ID_FRANJA_HORARIA NUMBER (5),
PRIMARY KEY (UVUS_PROFESOR,ID_FRANJA_HORARIA)
);


CREATE TABLE DEPARTAMENTOS(
ID_DEPARTAMENTO NUMBER(5) PRIMARY KEY,
NOMBRE VARCHAR2(50)
SIGLAS VARCHAR2(5)
);

CREATE TABLE ASIGNATURAS(
ID_ASIGNATURA NUMBER(5) PRIMARY KEY,
NOMBRE VARCHAR2(50),
SIGLAS VARCHAR2(8),
ID_DEPARTAMENTO NUMBER(5)
FOREIGN KEY (ID_DEPARTAMENTO) REFERENCES DEPARTAMENTOS,
);

CREATE TABLE ASIG_IMPARTIDAS(
UVUS_PROFESOR VARCHAR2(15),
ID_ASIGNATURA NUMBER(5)
PRIMARY KEY (UVUS_PROFESOR,ID_ASIGNATURA)
);


CREATE TABLE PROFESORES(
UVUS_PROFESOR VARCHAR2(15) PRIMARY KEY,
NOMBRE VARCHAR2(20),
APELLIDO1 VARCHAR2(20),
APELLIDO2 VARCHAR2(20),
PASSWORD VARCHAR2(20),
EMAIL VARCHAR2(50),
DESPACHO VARCHAR2(6),
DISPONIBILIDAD BOOLEAN DEFAULT FALSE,
PLANO_DESPACHO BLOB NULL,
FOTO_PERSONAL BLOB NULL,
ID_DEPARTAMENTO NUMBER(5),
ID_ASIG_IMPARTIDAS NUMBER(5),
FOREIGN KEY (ID_DEPARTAMENTO) REFERENCES DEPARTAMENTOS,
FOREIGN KEY (ID_ASIG_IMPARTIDAS) REFERENCES ASIG_IMPARTIDAS
);


CREATE TABLE RESERVAS(
ID_RESERVA NUMBER(10) PRIMARY KEY
FECHA DATE,
UVUS_ALUMNO VARCHAR2(15),
UVUS_PROFESOR VARCHAR2(15),
ID_FRANJA_HORARIA NUMBER(5),
FOREIGN KEY (UVUS_ALUMNO) REFERENCES USUARIOS,
FOREIGN KEY (UVUS_PROFESOR) REFERENCES PROFESOR,
FOREIGN KEY (ID_FRANJA_HORARIA) REFERENCES FRANJAS_HORARIAS
);



DROP SEQUENCE ID_FRANJA_HORARIA;
DROP SEQUENCE ID_RESERVA;
DROP SEQUENCE ID_DEPARTAMENTO;
DROP SEQUENCE ID_ASIGNATURA;



CREATE SEQUENCE SEC_ID_FRANJA_HORARIA INCREMENT BY 1 START WITH 1 NOMAXVALUE NOCYCLE;
CREATE SEQUENCE SEC_ID_RESERVA INCREMENT BY 1 START WITH 1 NOMAXVALUE NOCYCLE;
CREATE SEQUENCE SEC_ID_DEPARTAMENTO INCREMENT BY 1 START WITH 1 NOMAXVALUE NOCYCLE;
CREATE SEQUENCE SEC_ID_ASIGNATURA INCREMENT BY 1 START WITH 1 NOMAXVALUE NOCYCLE;



create or replace procedure INSERTAR_FRANJA_HORARIA (W_DIA_SEMANA VARCHAR2,W_HORA_INICIO VARCHAR2, W_HORA_FIN VARCHAR2)
as 
begin
    INSERT INTO FRANJAS_HORARIAS VALUES(SEC_ID_FRANJA_HORARIA.NextVal,W_DIA_SEMANA,W_HORA_INICIO,W_HORA_FIN);
end;
/


create or replace procedure INSERTAR_RESERVA (W_FECHA DATE, W_UVUS_ALUMNO VARCHAR2,W_UVUS_PROFESOR VARCHAR2,W_ID_FRANJA_HORARIA NUMBER)
as 
begin
    INSERT INTO RESERVAS VALUES(SEC_ID_RESERVA.NextVal,W_FECHA,W_UVUS_ALUMNO,W_UVUS_PROFESOR,W_ID_FRANJA_HORARIA);
end;
/



create or replace procedure INSERTAR_DEPARTAMENTO (W_NOMBRE VARCHAR2,W_SIGLAS VARCHAR2)
as 
begin
    INSERT INTO DEPARTAMENTOS VALUES(SEC_ID_DEPARTAMENTO.NextVal,W_NOMBRE,W_SIGLAS);
end;
/



create or replace procedure INSERTAR_ASIGNATURA (W_NOMBRE VARCHAR2,W_SIGLAS VARCHAR2,W_ID_DEPARTAMENTO NUMBER)
as 
begin
    INSERT INTO ASIGNATURAS VALUES(SEC_ID_ASIGNATURA.NextVal,W_NOMBRE,W_SIGLAS,W_ID_DEPARTAMENTO);
end;
/


INSERT INTO USUARIOS (UVUS_ALUMNO,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL) VALUES('alvsanmun','Álvaro','Santos','Muñoz','Admin1234','alvaro_santos92@hotmail.com');
INSERT INTO USUARIOS (UVUS_ALUMNO,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL) VALUES('enrparalv','Enrique','Pardo','Álvarez','Admin1234','enriquezpalvarez@gmail.com');
INSERT INTO USUARIOS (UVUS_ALUMNO,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL) VALUES('antjimveg','Antonio','Jimenez','Vega','Admin1234','ant.jim.v@gmail.com');
INSERT INTO USUARIOS (UVUS_ALUMNO,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL) VALUES('marestucl','Mario','Esteban','Uclés','Admin1234','mario.esteban@posteo.es');

INSERTAR_DEPARTAMENTO('Tecnología Electrónica', 'DTE');
INSERTAR_DEPARTAMENTO('Locos Sin Identificación', 'LSI');
INSERTAR_DEPARTAMENTO('Arquitectura y Tecnolog. de Computadores', 'ATC');
INSERTAR_DEPARTAMENTO('Matemática Aplicada I', 'MA1');
INSERTAR_DEPARTAMENTO('Biología Celular', 'BC');


INSERTAR_ASIGNATURA('Circuitos Electrónicos Digitales','CED',1)
INSERTAR_ASIGNATURA('Fundamentos de Programación','FP',2)
INSERTAR_ASIGNATURA('Arquitectura de Computadores','AC',3)
INSERTAR_ASIGNATURA('Álgebra Lineal y Numérica','ALN',4)
INSERTAR_ASIGNATURA('Estructura de Computadores','EdC',1)
INSERTAR_ASIGNATURA('Análisis y Diseño de Datos y Algoritmos','ADDA',2)
INSERTAR_ASIGNATURA('Arquitectura de Sistemas Distribuidos','ASD',3)
INSERTAR_ASIGNATURA('Cálculo Infinitesimal y Numérico','CIN',4)
INSERTAR_ASIGNATURA('Redes de Computadores','RC',1)
INSERTAR_ASIGNATURA('Introducción a la Ingeniería del Software y los Sistemas de Información','IISSI',2)
INSERTAR_ASIGNATURA('Configuración, Implementación, y Mantenimiento de Sistemas Informáticos','CIMSI',3)
INSERTAR_ASIGNATURA('Introducción a la Matemática Discreta','IMD',4)
INSERTAR_ASIGNATURA('Arquitectura de Redes','AR',1)
INSERTAR_ASIGNATURA('Sistemas Operativos','SO',2)
INSERTAR_ASIGNATURA('Computación Móvil','CM',3)
INSERTAR_ASIGNATURA('Matemática Discreta','MD',4)
INSERTAR_ASIGNATURA('Sistemas Orientados a Servicios','SOS',2)
INSERTAR_ASIGNATURA('Circuitos','C',3)
INSERTAR_ASIGNATURA('Matemática Aplicada a Sistemas de Información','MASI',4)
INSERTAR_ASIGNATURA('Anatomía y Fisiología','AF',5)




INSERT INTO PROFESORES (UVUS_PROFESOR,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL,DESPACHO,DISPONIBILIDAD,ID_DEPARTAMENTO,ID_ASIG_IMPARTIDAS) VALUES('profesor1','Jorge','Ropero','Sinde','Admin1234','hola@prof.es','G0.24',FALSE,1,1);
INSERT INTO PROFESORES (UVUS_PROFESOR,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL,DESPACHO,DISPONIBILIDAD,ID_DEPARTAMENTO,ID_ASIG_IMPARTIDAS) VALUES('profesor2','Rafa','Lopez','Martín','Admin1234','hola@prof.es','F0.24',FALSE,2,2);
INSERT INTO PROFESORES (UVUS_PROFESOR,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL,DESPACHO,DISPONIBILIDAD,ID_DEPARTAMENTO,ID_ASIG_IMPARTIDAS) VALUES('profesor3','Diego','Carrasco','Flores','Admin1234','hola@prof.es','E1.02',FALSE,3,3);
INSERT INTO PROFESORES (UVUS_PROFESOR,NOMBRE,APELLIDO1,APELLIDO2,PASSWORD,EMAIL,DESPACHO,DISPONIBILIDAD,ID_DEPARTAMENTO,ID_ASIG_IMPARTIDAS) VALUES('profesor4','Luis','Fernandez','Marquez','Admin1234','hola@prof.es','A0.44',FALSE,4,4);



